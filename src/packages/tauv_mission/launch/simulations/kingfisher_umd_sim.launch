<launch>
    <!-- This launchfile launches the full Guidance, Navigation, and Control system. -->
    <!-- This includes the cascaded pid controller, teleop node, and (TODO) the trajectory planner. -->

    <arg name="model_name" default="kingfisher_sim"/>
    <arg name="namespace" default="kf"/>
    <arg name="config_pkg" default="$(eval find(arg('model_name') + '_description'))"/>

    <arg name="launch_vision" default="true" />

    <include file="$(find tauv_sim_worlds)/launch/umd.launch" />

    <group ns="$(arg namespace)">
        <param name="tf_namespace" value="$(arg namespace)" />

        <include file="$(find tauv_common)/launch/alarms/alarms.launch" />

        <include file="$(arg config_pkg)/launch/upload.launch">
            <arg name="x" value="5" />
            <arg name="y" value="5" />
            <arg name="namespace" value="$(arg namespace)" />
        </include>

        <include file="$(find tauv_sim)/launch/vehicles/kingfisher_vehicle.launch" />

        <include file="$(arg config_pkg)/launch/transforms.launch">
            <arg name="namespace" value="$(arg namespace)" />
        </include>

        <node pkg="tauv_common" type="thruster_manager" name="thruster_manager" output="screen">
            <rosparam command="load" file="$(arg config_pkg)/yaml/thruster_manager.yaml" />
        </node>

        <node pkg="tauv_common" type="controller" name="controller" output="screen">
            <rosparam command="load" file="$(arg config_pkg)/yaml/controller.yaml" />
        </node>

        <node pkg="tauv_common" type="pid_planner" name="pid_planner" output="screen">
            <rosparam command="load" file="$(arg config_pkg)/yaml/pid_planner.yaml" />
        </node>

        <group if="$(arg launch_vision)">
            <include file="$(find tauv_common)/launch/darknet_ros/darknet_ros.launch">
                <arg name="model_name" value="$(arg model_name)" />
                <arg name="yolo_weights_path" value="/home/theo/weights" />
            </include>
        </group>
    </group>
</launch>
